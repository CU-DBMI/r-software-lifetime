---
title: "r-software-lifetime"
format:
  html:
    code-fold: true
    code-summary: "Show the code"
---

This website provides a quick visualization of the lifespans of different R versions. While the information exists on the web, summarized and glanceable details are somewhat scattered. This site brings it together with help from the [rversions package](https://cran.r-project.org/package=rversions). Click the "Show the code" button to view the code used to create each section.

```{r}
#| label: setup
#| echo: false
#| include: false
library(tidyverse)
library(magrittr)
library(rversions)
library(httr2)
library(lubridate)
library(plotly)
library(DT)
```

```{r}
#| label: data-munge

## r_versions_data
r_versions_data <-
    r_versions() %>% 
    arrange(package_version(version)) %>% 
    rename(release_date = date) %>% 
    mutate(
        version_fct = factor(version, levels = rev(unique(package_version(version)))),
        major_version = str_extract(version, "^[0-9]+\\.[0-9]+"),
        major_version = case_when(
          as.numeric(major_version) < 1 ~ NA_character_, 
          TRUE ~ major_version
          ),
        major_version_fct = factor(major_version, levels = rev(unique(package_version(major_version)))), 
        superseded_date = lead(release_date),
        superseded_date = replace_na(superseded_date, now()),
        nickname = case_when(
          is.na(nickname) ~ glue::glue('v{version}'), 
          TRUE ~ glue::glue('v{version}: {nickname}'))
    ) %>% 
    relocate(superseded_date, .after = release_date)

## osv-vulnerabilities
source('utils/osv-cve-helper.R')
r_base_vulns <- query_osv(name = 'r-base', ecosystem = 'Debian')
r_base_vulns_data <- 
  r_base_vulns %>% 
  separate(fixed, into = c('fixed_r_version', 'ecosystem_revision'), sep = '-')

## combined
combined <- 
  r_versions_data %>% 
  cross_join(r_base_vulns_data) %>% 
  tibble::as_tibble() %>% 
  mutate(is_vulnerable = package_version(as.character(version)) < package_version(fixed_r_version)) %>% 
  group_by(major_version, major_version_fct) %>% 
  summarize(
    release_date = min(release_date, na.rm = TRUE),
    superseded_date = max(superseded_date, na.rm = TRUE),
    is_vulnerable = any(is_vulnerable), 
    nickname = nickname[which.min(release_date)],
    .groups = 'drop'
    )
```

## Version History

```{r}
#| label: data-table-r_versions
r_versions_data %>% 
  select(-c(ends_with("_fct"), major_version)) %>% 
  datatable(
    options = list(
      scrollY = 425,
      scroller = TRUE
      ), 
    rownames = FALSE
  )
```

```{r}
#| label: plotly
combined %>%  
  plot_ly() %>% 
  add_segments(
    x = ~release_date, xend = ~superseded_date, 
    y = ~major_version, yend = ~major_version,
    color = ~is_vulnerable,
    colors = c("FALSE" = "steelblue", "TRUE" = "red"),
    line = list(width = 6),
    hoverinfo = 'text', text = ~nickname
  ) %>% 
  layout(
    title = "R Major Version Lifespan",
    xaxis = list(title = "Date"),
    yaxis = list(
      title = "Major Version",
      type = "category",
      categoryorder = "array",
      categoryarray = sort(unique(combined$major_version_fct))
    ),
    legend = list(
      title = list(text = "CVE Exists")
    )
  )
```

## R-Project Vulnerability Information

Current and historical vulnerability tracking information for R. This should not be considered a endorsement for which version of R to use, but rather a resource to help users stay informed and make an informed decision based on official guidance and project documentation.


```{r}
#| label: data-table-osv-vulnerabilities
r_base_vulns %>% 
  mutate(
    id = glue::glue("<a href='https://osv.dev/vulnerability/{id}' target='_blank'>{id}</a>")
    ) %>% 
  select(-references) %>% 
  datatable(
    options = list(
      scrollX = TRUE,
      scrollY = 425,
      scroller = TRUE
      ), 
    rownames = FALSE,
    escape = FALSE
  )
```